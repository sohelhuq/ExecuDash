/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes rapid prototyping by focusing on authorization and skipping data validation.
 * It assumes data integrity is managed at the application level.
 *
 * Data Structure:
 * The Firestore database stores employee records and attendance points.
 * - /attendance_points/{pointId}: Stores individual attendance point entries.
 * - /employees/{employeeId}: Stores employee profile information.
 *
 * Key Security Decisions:
 * - User listing is generally disallowed to prevent information disclosure.
 * - All write operations are restricted to authenticated users.
 * - No data validation is performed beyond ensuring essential relational integrity.
 *
 * Denormalization for Authorization:
 * This ruleset doesn't currently use denormalization, but in a more complex application, consider adding fields like `ownerId` or `memberIds` directly to documents to simplify authorization logic and improve performance.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to attendance point documents.
     * @path /attendance_points/{pointId}
     * @allow (create) - Authenticated users can create new attendance point entries. No data validation beyond authentication is enforced during the prototyping phase.
     * @allow (get, list) - Public read access to all attendance point entries.
     * @allow (update, delete) - Authenticated users can update or delete any attendance point entry.
     * @deny (create) - Unauthenticated users cannot create attendance point entries.
     * @principle Allows public read access but requires authentication for all write operations.
     */
    match /attendance_points/{pointId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Controls access to employee documents.
     * @path /employees/{employeeId}
     * @allow (create) - Authenticated users can create new employee records. No data validation beyond authentication is enforced during the prototyping phase.
     * @allow (get, list) - Public read access to employee records.
     * @allow (update, delete) - Authenticated users can update or delete any employee record.
     * @deny (create) - Unauthenticated users cannot create employee records.
     * @principle Allows public read access but requires authentication for all write operations.
     */
    match /employees/{employeeId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}