/**
 * @file Overview
 * This ruleset enforces a basic security model focused on prototype access.
 *
 * Data Structure:
 * - /attendance_points/{pointId}: Stores attendance records, read and write access open to all authenticated users.
 * - /employees/{employeeId}: Stores employee data, read and write access open to all authenticated users.
 *
 * Key Security Decisions:
 * - No specific role-based access control is enforced.
 * - All read and write operations are allowed for any signed-in user during prototyping.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any authenticated user to read and write attendance points.
     * @path /attendance_points/{pointId}
     * @allow (list, get) Any signed-in user can retrieve attendance points.
     * @allow (create, update, delete) Any signed-in user can create, update, or delete attendance points.
     * @deny  (create, update, delete)  if the user is not signed in
     * @principle Allows open read/write access to attendance data for authenticated users.
     */
    match /attendance_points/{pointId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows any authenticated user to read and write employee records.
     * @path /employees/{employeeId}
     * @allow (list, get) Any signed-in user can retrieve employee records.
     * @allow (create, update, delete) Any signed-in user can create, update, or delete employee records.
     * @deny  (create, update, delete)  if the user is not signed in
     * @principle Allows open read/write access to employee data for authenticated users.
     */
    match /employees/{employeeId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}