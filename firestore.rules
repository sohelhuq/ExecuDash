rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Enforces user-ownership for user profiles.
     * @path /users/{userId}
     * @allow (create) - A user can create their own profile if the userId matches their auth UID.
     * @allow (get, list, update, delete) - A user can only access their own profile.
     * @deny (create) - A user cannot create a profile with a userId that doesn't match their auth UID.
     * @principle Enforces document ownership for writes.
     */
    match /users/{userId} {
      function isOwner(userId) {
        return request.auth != null && request.auth.uid == userId;
      }
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn() && isOwner(userId);
      allow list: if false;
      allow create: if isSignedIn() && isOwner(userId);
      allow update: if isSignedIn() && isOwner(userId);
      allow delete: if isSignedIn() && isOwner(userId);
    }

    /**
     * @description Enforces user-ownership for dashboards.
     * @path /users/{userId}/dashboards/{dashboardId}
     * @allow (create) - A user can create a dashboard under their userId.
     * @allow (get, list, update, delete) - A user can only access and modify their own dashboards.
     * @deny (create) - A user cannot create a dashboard under another user's userId.
     * @principle Restricts access to a user's own data tree.
     */
    match /users/{userId}/dashboards/{dashboardId} {
      function isOwner(userId) {
        return request.auth != null && request.auth.uid == userId;
      }
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn() && isOwner(userId);
      allow list: if isSignedIn() && isOwner(userId);
      allow create: if isSignedIn() && isOwner(userId);
      allow update: if isSignedIn() && isOwner(userId);
      allow delete: if isSignedIn() && isOwner(userId);
    }

    /**
     * @description Allows authenticated users to read and write business unit data.
     * @path /business_units/{businessUnitId}
     * @allow (get, list) - Any authenticated user can read business unit data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete business unit data.
     * @deny (create, update, delete) - Unauthenticated users cannot create, update, or delete business unit data.
     * @principle Requires authentication for data access.
     */
    match /business_units/{businessUnitId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write metric data associated with a business unit.
     * @path /business_units/{businessUnitId}/metrics/{metricId}
     * @allow (get, list) - Any authenticated user can read metric data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete metric data.
     * @deny (create, update, delete) - Unauthenticated users cannot create, update, or delete metric data.
     * @principle Requires authentication for data access.
     */
    match /business_units/{businessUnitId}/metrics/{metricId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write widget data associated with a business unit.
     * @path /business_units/{businessUnitId}/widgets/{widgetId}
     * @allow (get, list) - Any authenticated user can read widget data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete widget data.
     * @deny (create, update, delete) - Unauthenticated users cannot create, update, or delete widget data.
     * @principle Requires authentication for data access.
     */
    match /business_units/{businessUnitId}/widgets/{widgetId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write alert data.
     * @path /alerts/{alertId}
     * @allow (get, list) - Any authenticated user can read alert data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete alert data.
     * @deny (create, update, delete) - Unauthenticated users cannot create, update, or delete alert data.
     * @principle Requires authentication for data access.
     */
    match /alerts/{alertId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write assigned account data.
     * @path /assigned_accounts/{accountId}
     * @allow (get, list) - Any authenticated user can read assigned account data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete assigned account data.
     * @deny (create, update, delete) - Unauthenticated users cannot create, update, or delete assigned account data.
     * @principle Requires authentication for data access.
     */
    match /assigned_accounts/{accountId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write responsibility data.
     * @path /responsibilities/{responsibilityId}
     * @allow (get, list) - Any authenticated user can read responsibility data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete responsibility data.
     * @deny (create, update, delete) - Unauthenticated users cannot create, update, or delete responsibility data.
     * @principle Requires authentication for data access.
     */
    match /responsibilities/{responsibilityId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write invoice data.
     * @path /invoices/{invoiceId}
     * @allow (get, list) - Any authenticated user can read invoice data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete invoice data.
     * @deny (create, update, or delete) - Unauthenticated users cannot create, update, or delete invoice data.
     * @principle Requires authentication for data access.
     */
    match /invoices/{invoiceId} {
      function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write KPI data.
     * @path /kpis/{kpiId}
     * @allow (get, list) - Any authenticated user can read KPI data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete KPI data.
     * @deny (create, update, or delete) - Unauthenticated users cannot create, update, or delete KPI data.
     */
    match /kpis/{kpiId} {
       function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows authenticated users to read and write revenue trend data.
     * @path /revenue_trends/{trendId}
     * @allow (get, list) - Any authenticated user can read revenue trend data.
     * @allow (create, update, delete) - Only authenticated users can create, update, or delete revenue trend data.
     * @deny (create, update, or delete) - Unauthenticated users cannot create, update, or delete revenue trend data.
     */
    match /revenue_trends/{trendId} {
       function isSignedIn() {
        return request.auth != null;
      }

      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }
}