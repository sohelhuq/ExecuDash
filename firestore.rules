rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Enforces user-ownership for user profiles. Only the authenticated user can read and write their own profile.
     * @path /users/{userId}
     * @allow (create) User with UID 'user123' can create their profile at /users/user123.
     * @allow (get, update, delete) User with UID 'user123' can get, update, and delete their profile at /users/user123.
     * @deny (create, get, update, delete) User with UID 'user456' cannot access /users/user123.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userId} {
      // Allow the user to read their own profile
      allow get: if request.auth.uid == userId;
      // Prevent listing of all users
      allow list: if false;
      // Allow the user to create their own profile, enforcing that the userId matches the authenticated user's UID.
      allow create: if request.auth.uid == userId;
      // Allow the user to update their own profile
      allow update: if request.auth.uid == userId && request.auth != null;
      // Allow the user to delete their own profile
      allow delete: if request.auth.uid == userId && request.auth != null;
    }

    /**
     * @description Enforces user-ownership for dashboards. Only the authenticated user can manage their own dashboards.
     * @path /users/{userId}/dashboards/{dashboardId}
     * @allow (create) User with UID 'user123' can create a dashboard at /users/user123/dashboards/dashboard456.
     * @allow (get, update, delete) User with UID 'user123' can get, update, and delete their dashboard at /users/user123/dashboards/dashboard456.
     * @deny (create, get, update, delete) User with UID 'user456' cannot access /users/user123/dashboards/dashboard456.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userId}/dashboards/{dashboardId} {
      // Allow the user to read their own dashboard
      allow get: if request.auth.uid == userId;
      // Allow the user to list their own dashboards
      allow list: if request.auth.uid == userId;
      // Allow the user to create their own dashboard, enforcing that the userId matches the authenticated user's UID.
      allow create: if request.auth.uid == userId;
      // Allow the user to update their own dashboard
      allow update: if request.auth.uid == userId && request.auth != null;
      // Allow the user to delete their own dashboard
      allow delete: if request.auth.uid == userId && request.auth != null;
    }

    /**
     * @description Allows public read access to business unit data, but requires authentication for writes.
     * @path /business_units/{businessUnitId}
     * @allow (get, list) Any user can read business unit data.
     * @allow (create, update, delete) Only authenticated users can create, update, or delete business unit data.
     * @deny Unauthenticated users cannot create, update, or delete business unit data.
     * @principle Allows public reads with authenticated writes.
     */
    match /business_units/{businessUnitId} {
      // Allow anyone to read business unit data
      allow get, list: if true;
      // Only signed-in users can create, update, or delete business units
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }

    /**
     * @description Allows public read access to metrics data, but requires authentication for writes.
     * @path /business_units/{businessUnitId}/metrics/{metricId}
     * @allow (get, list) Any user can read metrics data.
     * @allow (create, update, delete) Only authenticated users can create, update, or delete metrics data.
     * @deny Unauthenticated users cannot create, update, or delete metrics data.
     * @principle Allows public reads with authenticated writes.
     */
    match /business_units/{businessUnitId}/metrics/{metricId} {
      // Allow anyone to read metrics data
      allow get, list: if true;
      // Only signed-in users can create, update, or delete metrics
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }

    /**
     * @description Allows public read access to widgets data, but requires authentication for writes.
     * @path /business_units/{businessUnitId}/widgets/{widgetId}
     * @allow (get, list) Any user can read widgets data.
     * @allow (create, update, delete) Only authenticated users can create, update, or delete widgets data.
     * @deny Unauthenticated users cannot create, update, or delete widgets data.
     * @principle Allows public reads with authenticated writes.
     */
    match /business_units/{businessUnitId}/widgets/{widgetId} {
      // Allow anyone to read widgets data
      allow get, list: if true;
      // Only signed-in users can create, update, or delete widgets
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }

    /**
     * @description Requires authentication for all access to alert configurations.
     * @path /alerts/{alertId}
     * @allow (create, get, list, update, delete) Only authenticated users can manage alerts.
     * @deny Unauthenticated users cannot access alert configurations.
     * @principle Requires authentication for all operations.
     */
    match /alerts/{alertId} {
      // Only signed-in users can access alerts
      allow get: if request.auth != null;
      allow list: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }

    /**
     * @description Requires authentication for all access to assigned accounts.
     * @path /assigned_accounts/{accountId}
     * @allow (create, get, list, update, delete) Only authenticated users can manage assigned accounts.
     * @deny Unauthenticated users cannot access assigned accounts.
     * @principle Requires authentication for all operations.
     */
    match /assigned_accounts/{accountId} {
      // Only signed-in users can access assigned accounts
      allow get: if request.auth != null;
      allow list: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }

    /**
     * @description Requires authentication for all access to responsibilities.
     * @path /responsibilities/{responsibilityId}
     * @allow (create, get, list, update, delete) Only authenticated users can manage responsibilities.
     * @deny Unauthenticated users cannot access responsibilities.
     * @principle Requires authentication for all operations.
     */
    match /responsibilities/{responsibilityId} {
      // Only signed-in users can access responsibilities
      allow get: if request.auth != null;
      allow list: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }

    /**
     * @description Requires authentication for all access to invoices.
     * @path /invoices/{invoiceId}
     * @allow (create, get, list, update, delete) Only authenticated users can manage invoices.
     * @deny Unauthenticated users cannot access invoices.
     * @principle Requires authentication for all operations.
     */
    match /invoices/{invoiceId} {
      // Only signed-in users can access invoices
      allow get: if request.auth != null;
      allow list: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth != null;
    }
  }
}