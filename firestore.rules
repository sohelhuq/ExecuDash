/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes rapid prototyping by focusing on authorization and skipping schema validation.
 * It uses a strict ownership model for user-specific data and public read access where appropriate.
 *
 * Data Structure:
 * - /attendance_points/{pointId}: Stores attendance points for employees.
 * - /employees/{employeeId}: Stores employee records.
 *
 * Key Security Decisions:
 * - Listing of rent entries is denied to all users for security reasons.
 * - Missing schema validation for rapid iteration.
 *
 * Denormalization for Authorization: N/A
 * Structural Segregation: N/A
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to the attendance_points collection.
     * @path /attendance_points/{pointId}
     * @allow (create, update, delete) if isSignedIn() : Allows authenticated users to create, update and delete an attendance point.
     * @allow (get, list) if true: Allows public read access to all attendance points.
     * @deny (create, update, delete) if !isSignedIn(): Denies unauthenticated users to create, update and delete an attendance point.
     * @principle Allows authenticated users to manage attendance points.
     */
    match /attendance_points/{pointId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Controls access to the employees collection.
     * @path /employees/{employeeId}
     * @allow (create, update, delete) if isSignedIn() : Allows authenticated users to create, update and delete an employee.
     * @allow get, list: if true : Allows public read access to all employees.
     * @deny (create, update, delete) if !isSignedIn(): Denies unauthenticated users to create, update and delete an employee.
     * @principle Allows authenticated users to manage employees.
     */
    match /employees/{employeeId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Protects the /rent_entries collection from being listed.  This collection should not be directly exposed.
     * @path /rent_entries
     * @deny list: Denies listing of rent entries to all users.
     * @principle Prevents unauthorized access to potentially sensitive rent entry data by disallowing list operations.
     */
    match /rent_entries {
        allow get: if false;
        allow list: if false;
        allow create: if false;
        allow update: if false;
        allow delete: if false;
    }


    function isSignedIn() {
      return request.auth != null;
    }
  }
}